<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>أذكار الصباح والمساء</title>
  <style>
    :root{--bg:#0b0c10;--card:#1f232b;--ink:#e6edf3;--muted:#9aa4b2;--accent:#3ea6ff}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial}
    .app{width:min(700px,94vw);margin:22px auto;padding:18px;background:var(--card);border-radius:16px}
    h1{margin:0 0 10px;text-align:center;font-size:20px}
    .row{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
    .btn{appearance:none;border:1px solid #3a4150;border-radius:10px;padding:10px 14px;background:#2b313c;color:var(--ink);cursor:pointer;font-weight:700}
    .btn.primary{background:#213445}
    .btn:active{transform:translateY(1px)}
    .desc{color:var(--muted);text-align:center;font-size:13px;margin:4px 0 10px}

    /* full-card */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.66);display:none;z-index:900}
    .card{position:fixed;inset:12px;background:#101319;border:1px solid #2a313f;border-radius:16px;padding:16px;display:none;z-index:901;overflow:auto}
    .card header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .title{margin:0;font-size:16px}
    .progress{font-size:12px;color:var(--muted)}
    .text{font-size:18px;line-height:1.9;white-space:pre-wrap;margin:10px 0}
    .meta{font-size:13px;color:var(--muted)}
    .nav{display:flex;gap:10px;position:sticky;bottom:0;background:#101319;padding-top:10px}
    .nav .btn{flex:1}

    /* auto tasbih section (only for repeat=100) */
    .auto{display:none;gap:8px;align-items:center;justify-content:center;margin:8px 0}
    .auto .btn{border:0}
    .auto .btn.stop{background:#402b2b}

    /* completion message */
    .done-ov{position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:2000}
    .done-box{background:#1f232b;color:var(--ink);border-radius:14px;padding:18px;text-align:center;max-width:min(90vw,440px)}
  </style>
</head>
<body>
  <main class="app">
    <h1>أذكار الصباح والمساء</h1>
    <p class="desc">اختر الوقت، ثم ابدأ. ستُعرض الأذكار ببطاقة كاملة؛ اضغط داخل البطاقة للانتقال.</p>

    <div class="row" style="margin-bottom:10px">
      <button class="btn" id="modeMorning">أذكار الصباح</button>
      <button class="btn" id="modeEvening">أذكار المساء</button>
    </div>

    <div class="row">
      <button class="btn primary" id="start">ابدأ القراءة</button>
      <a class="btn" href="index.html">العودة للعداد</a>
    </div>
  </main>

  <div class="overlay" id="ov"></div>
  <section class="card" id="card" tabindex="0" aria-live="polite" aria-atomic="true">
    <header>
      <div>
        <h2 class="title" id="title">ذكر</h2>
        <div class="progress" id="prog">1 / 1</div>
      </div>
      <button class="btn" id="close">إغلاق</button>
    </header>

    <article class="text" id="text"></article>
    <div class="meta" id="meta"></div>

    <div class="auto" id="auto">
      <button class="btn" id="autoBtn">بدء التسبيح التلقائي (1 ثانية × 100)</button>
      <span id="autoNote" style="color:var(--muted);font-size:12px">جاهز</span>
    </div>

    <div class="nav">
      <button class="btn" id="prev">السابق</button>
      <button class="btn primary" id="next">التالي</button>
    </div>
  </section>

  <script>
  'use strict';
  /* Texts */
  const AYAH=`﴿اللَّهُ لَا إِلَهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ ...﴾ (البقرة: 255)`;
  const IKHLAS=`﴿قُلْ هُوَ اللَّهُ أَحَدٌ ...﴾`;
  const FALAQ=`﴿قُلْ أَعُوذُ بِرَبِّ الْفَلَقِ ...﴾`;
  const NAS=`﴿قُلْ أَعُوذُ بِرَبِّ النَّاسِ ...﴾`;

  const MORNING=[
    {title:'آية الكرسي', repeat:1, text:AYAH, ref:'مرة واحدة'},
    {title:'المعوذات', repeat:3, text:`${IKHLAS}\n\n${FALAQ}\n\n${NAS}`, ref:'ثلاث مرات'},
    {title:'يا حي يا قيوم برحمتك أستغيث', repeat:1, text:'يا حي يا قيوم برحمتك أستغيث، أصلح لي شأني كله، ولا تكلني إلى نفسي طرفة عين.', ref:'مرة واحدة'},
    {title:'اللهم بك أصبحنا...', repeat:1, text:'اللهم بك أصبحنا وبك أمسينا، وبك نحيا وبك نموت وإليك النشور.', ref:'مرة واحدة'},
    {title:'سبحان الله وبحمده، عدد خلقه...', repeat:3, text:'سبحان الله وبحمده، عدد خلقه، ورضا نفسه، وزنة عرشه، ومداد كلماته.', ref:'ثلاث مرات'},
    {title:'أعوذ بكلمات الله التامات...', repeat:3, text:'أعوذ بكلمات الله التامات من شر ما خلق.', ref:'ثلاث مرات'},
    {title:'اللهم عافني في بدني...', repeat:3, text:'اللهم عافِني في بدني، اللهم عافِني في سمعي، اللهم عافِني في بصري، لا إله إلا أنت.', ref:'ثلاث مرات'},
    {title:'اللهم إني أسألك العفو والعافية...', repeat:1, text:'اللهم إني أسألك العفو والعافية في الدنيا والآخرة.', ref:'مرة واحدة'},
    {title:'اللهم ما أصبح بي من نعمة...', repeat:1, text:'اللهم ما أصبح بي من نعمةٍ أو بأحدٍ من خلقك فمنك وحدك لا شريك لك، فلك الحمد.', ref:'مرة واحدة'},
    {title:'بسم الله الذي لا يضر...', repeat:3, text:'بسم الله الذي لا يضر مع اسمه شيء في الأرض ولا في السماء وهو السميع العليم.', ref:'ثلاث مرات'},
    {title:'رضيت بالله ربًّا...', repeat:3, text:'رضيت بالله ربًّا، وبالإسلام دينًا، وبمحمد ﷺ نبيًّا.', ref:'ثلاث مرات'},
    {title:'سبحان الله وبحمده (100 مرة صباحًا)', repeat:100, text:'سبحان الله وبحمده.', ref:'مائة مرة'},
    {title:'ربنا آتنا في الدنيا حسنة...', repeat:1, text:'رَبَّنَا آتِنَا فِي الدُّنْيَا حَسَنَةً وَفِي الآخِرَةِ حَسَنَةً وَقِنَا عَذَابَ النَّارِ.', ref:'مرة واحدة'},
    {title:'سيد الاستغفار', repeat:1, text:'اللهم أنت ربي لا إله إلا أنت، خلقتني وأنا عبدك ... فاغفر لي، فإنه لا يغفر الذنوب إلا أنت.', ref:'مرة واحدة'},
  ];
  const EVENING=[
    {title:'آية الكرسي', repeat:1, text:AYAH, ref:'مرة واحدة'},
    {title:'المعوذات', repeat:3, text:`${IKHLAS}\n\n${FALAQ}\n\n${NAS}`, ref:'ثلاث مرات'},
    {title:'يا حي يا قيوم برحمتك أستغيث', repeat:1, text:'يا حي يا قيوم برحمتك أستغيث، أصلح لي شأني كله، ولا تكلني إلى نفسي طرفة عين.', ref:'مرة واحدة'},
    {title:'اللهم بك أمسينا...', repeat:1, text:'اللهم بك أمسينا وبك أصبحنا، وبك نحيا وبك نموت وإليك المصير.', ref:'مرة واحدة'},
    {title:'سبحان الله وبحمده، عدد خلقه...', repeat:3, text:'سبحان الله وبحمده، عدد خلقه، ورضا نفسه، وزنة عرشه، ومداد كلماته.', ref:'ثلاث مرات'},
    {title:'أعوذ بكلمات الله التامات...', repeat:3, text:'أعوذ بكلمات الله التامات من شر ما خلق.', ref:'ثلاث مرات'},
    {title:'اللهم عافني في بدني...', repeat:3, text:'اللهم عافِني في بدني، اللهم عافِني في سمعي، اللهم عافِني في بصري، لا إله إلا أنت.', ref:'ثلاث مرات'},
    {title:'اللهم إني أسألك العفو والعافية...', repeat:1, text:'اللهم إني أسألك العفو والعافية في الدنيا والآخرة.', ref:'مرة واحدة'},
    {title:'اللهم ما أمسى بي من نعمة...', repeat:1, text:'اللهم ما أمسى بي من نعمةٍ أو بأحدٍ من خلقك فمنك وحدك لا شريك لك، فلك الحمد.', ref:'مرة واحدة'},
    {title:'بسم الله الذي لا يضر...', repeat:3, text:'بسم الله الذي لا يضر مع اسمه شيء في الأرض ولا في السماء وهو السميع العليم.', ref:'ثلاث مرات'},
    {title:'رضيت بالله ربًّا...', repeat:3, text:'رضيت بالله ربًّا، وبالإسلام دينًا، وبمحمد ﷺ نبيًّا.', ref:'ثلاث مرات'},
    {title:'سبحان الله وبحمده (100 مرة مساءً)', repeat:100, text:'سبحان الله وبحمده.', ref:'مائة مرة — «غُفرت خطاياه ولو كانت مثل زبد البحر»'},
    {title:'ربنا آتنا في الدنيا حسنة...', repeat:1, text:'رَبَّنَا آتِنَا فِي الدُّنْيَا حَسَنَةً وَفِي الآخِرَةِ حَسَنَةً وَقِنَا عَذَابَ النَّارِ.', ref:'مرة واحدة'},
    {title:'سيد الاستغفار', repeat:1, text:'اللهم أنت ربي لا إله إلا أنت، خلقتني وأنا عبدك ... فاغفر لي، فإنه لا يغفر الذنوب إلا أنت.', ref:'مرة واحدة'},
  ];

  const $=s=>document.querySelector(s);
  const ov=$('#ov'), card=$('#card'), t=$('#title'), p=$('#prog'), txt=$('#text'), meta=$('#meta');
  const auto=$('#auto'), autoBtn=$('#autoBtn'), autoNote=$('#autoNote');
  const prev=$('#prev'), next=$('#next'), close=$('#close');
  const bMorning=$('#modeMorning'), bEvening=$('#modeEvening'), bStart=$('#start');

  const LS='adhkar.progress.v2';
  let mode='morning', list=MORNING, i=0, rep=1, autoTimer=null;

  function setMode(m){ stopAuto(); mode=m; list=(m==='evening')?EVENING:MORNING; i=0; rep=1; save(); }
  function save(){ try{ localStorage.setItem(LS, JSON.stringify({mode,i,rep})); }catch{} }
  function load(){ try{ const d=JSON.parse(localStorage.getItem(LS)); if(!d) return; setMode(d.mode==='evening'?'evening':'morning'); i=Math.min(Math.max(0,d.i|0),list.length-1); rep=Math.min(Math.max(1,d.rep|0),(list[i].repeat||1)); }catch{} }

  function render(){
    const item=list[i];
    const hideTitle = item.text && item.title && item.text.replace(/\s+/g,' ').startsWith(item.title.replace(/\s+/g,' '));
    t.textContent=item.title||'ذكر'; t.style.display=hideTitle?'none':'';
    p.textContent=`${i+1} / ${list.length}`;
    txt.textContent=item.text||''; meta.textContent=item.ref||'';
    const total=item.repeat||1;

    if(total===100){
      auto.style.display='flex';
      autoNote.textContent = autoTimer?`يعمل… (${rep}/100)`:'جاهز';
      autoBtn.textContent  = autoTimer?'إيقاف التسبيح التلقائي':'بدء التسبيح التلقائي (1 ثانية × 100)';
      autoBtn.classList.toggle('stop', !!autoTimer);
    }else{
      stopAuto(); auto.style.display='none';
    }
  }

  function open(){ ov.style.display='block'; card.style.display='block'; render(); setTimeout(()=>card.focus(),0); }
  function closeCard(){ stopAuto(); ov.style.display='none'; card.style.display='none'; }

  // default next/prev (increase repetition or move)
  function nextDefault(){
    const total=(list[i].repeat||1);
    if(rep<total){ rep++; }
    else{ stopAuto(); if(i<list.length-1){ i++; rep=1; } else{ alert('تمت أذكار هذا الوقت.'); closeCard(); return; } }
    save(); render();
  }
  function prevDefault(){
    stopAuto();
    if(rep>1){ rep--; }
    else if(i>0){ i--; rep=(list[i].repeat||1); }
    save(); render();
  }

  // Special behavior for 100-repeat card: buttons change the CARD (not repetition)
  function nextBtnAction(){ const total=list[i].repeat||1; if(total===100){ stopAuto(); if(i<list.length-1){ i++; rep=1; save(); render(); } else { alert('تمت أذكار هذا الوقت.'); closeCard(); } } else { nextDefault(); } }
  function prevBtnAction(){ const total=list[i].repeat||1; if(total===100){ stopAuto(); if(i>0){ i--; rep=list[i].repeat||1; save(); render(); } } else { prevDefault(); } }

  // Auto tasbih (1s x 100). When hits 100: show dismissible overlay; do NOT auto-advance.
  function startAuto(){
    if(autoTimer) return;
    if((list[i].repeat||1)!==100) return;
    autoTimer=setInterval(()=>{
      if(rep<100){ rep++; autoNote.textContent=`يعمل… (${rep}/100)`; }
      else{
        clearInterval(autoTimer); autoTimer=null;
        const d=document.createElement('div'); d.className='done-ov';
        d.innerHTML='<div class="done-box">اكتمل العدد (100). انقر للإغلاق.</div>';
        d.addEventListener('click',()=>document.body.removeChild(d),{once:true});
        document.body.appendChild(d);
        autoNote.textContent='اكتمل (100/100)';
        autoBtn.textContent='بدء التسبيح التلقائي (1 ثانية × 100)';
        autoBtn.classList.remove('stop');
      }
    },1000);
    render();
  }
  function stopAuto(){ if(autoTimer){ clearInterval(autoTimer); autoTimer=null; } }

  /* events */
  bMorning.onclick=()=>{ setMode('morning'); save(); };
  bEvening.onclick=()=>{ setMode('evening'); save(); };
  bStart.onclick=open; close.onclick=closeCard;
  next.onclick=nextBtnAction; prev.onclick=prevBtnAction;
  autoBtn.onclick=()=>{ if(autoTimer) stopAuto(); else startAuto(); render(); };

  card.addEventListener('click',(e)=>{ if(e.target.closest('header,.nav,.auto,button')) return; nextDefault(); });
  card.addEventListener('keydown',(e)=>{ if(['Enter',' ','ArrowRight'].includes(e.key)){ e.preventDefault(); nextBtnAction(); } if(e.key==='ArrowLeft'){ e.preventDefault(); prevBtnAction(); } if(e.key==='Escape'){ e.preventDefault(); closeCard(); } });

  // init
  setMode('morning'); load();
  </script>
</body>
</html>
